<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SIMRS - Loket Pendaftaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "blue-primary": "#4F46E5",
              "blue-light": "#EEF2FF",
              "gray-light": "#F8FAFC",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50 font-inter">
    <!-- Kontainer Sidebar -->
    <div id="sidebar-container"></div>
    <script>
      fetch("../../src/components/sidebar.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("sidebar-container").innerHTML = html;
        });
    </script>

    <!-- Konten Utama -->
    <div class="lg:ml-64 min-h-screen">
      <!-- Header -->
      <header class="bg-white shadow-sm border-b sticky top-0 z-40">
        <div class="flex items-center justify-between px-4 lg:px-6 py-4">
          <nav class="flex items-center space-x-2 text-sm text-gray-600">
            <span>Home</span>
            <span>></span>
            <span class="text-gray-900 font-medium">Loket Pendaftaran</span>
          </nav>
          <div class="flex items-center space-x-2">
            <span class="text-gray-700 hidden sm:block">Admin</span>
            <button class="p-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-user-circle text-gray-500"></i>
            </button>
          </div>
        </div>
      </header>

      <!-- Konten Utama -->
      <div class="p-4 lg:p-6">
        <div class="max-w-7xl mx-auto">
          <!-- Section Filter dan Antrian -->
          <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
            <!-- Div Filter Data -->
            <div
              class="xl:col-span-2 bg-blue-light p-4 lg:p-6 rounded-lg border border-blue-200"
            >
              <h2 class="text-lg font-bold text-blue-600 mb-6">FILTER DATA</h2>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6 mb-6">
                <!-- Input Tanggal Registrasi -->
                <div>
                  <label class="block text-sm font-medium mb-2"
                    >TANGGAL REGISTRASI</label
                  >
                  <div class="flex flex-col sm:flex-row items-center gap-3">
                    <input
                      type="date"
                      id="dateFrom"
                      value="2025-07-16"
                      class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    />
                    <span class="text-sm text-gray-600 font-medium">s.d.</span>
                    <input
                      type="date"
                      id="dateTo"
                      value="2025-07-16"
                      class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    />
                  </div>
                </div>

                <!-- Filter Cara Bayar -->
                <div>
                  <label class="block text-sm font-medium mb-2"
                    >CARA BAYAR</label
                  >
                  <div class="relative">
                    <select
                      id="filterPayment"
                      class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                    >
                      <option value="">Semua</option>
                      <option value="BPJS">BPJS</option>
                      <option value="Umum">Umum</option>
                      <option value="Asuransi">Asuransi</option>
                    </select>
                    <span
                      class="absolute inset-y-0 right-3 flex items-center pointer-events-none"
                    >
                      <svg
                        class="w-4 h-4 text-gray-800"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m19 9-7 7-7-7"
                        />
                      </svg>
                    </span>
                  </div>
                </div>

                <!-- Filter Poliklinik -->
                <div>
                  <label class="block text-sm font-medium mb-2"
                    >POLIKLINIK</label
                  >
                  <div class="relative">
                    <select
                      id="filterClinic"
                      class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                    >
                      <option value="">Semua</option>
                      <option value="Poli Bedah Ortopedi">
                        Poli Bedah Ortopedi
                      </option>
                      <option value="Poli Gigi">Poli Gigi</option>
                      <option value="Poli Umum">Poli Umum</option>
                      <option value="Poli Jantung">Poli Jantung</option>
                      <option value="Poli Anak">Poli Anak</option>
                      <option value="Poli Mata">Poli Mata</option>
                      <option value="Poli THT">Poli THT</option>
                      <option value="Poli Kulit & Kelamin">
                        Poli Kulit & Kelamin
                      </option>
                      <option value="Poli Paru">Poli Paru</option>
                    </select>
                    <span
                      class="absolute inset-y-0 right-3 flex items-center pointer-events-none"
                    >
                      <svg
                        class="w-4 h-4 text-gray-800"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m19 9-7 7-7-7"
                        />
                      </svg>
                    </span>
                  </div>
                </div>

                <!-- Filter Dokter -->
                <div>
                  <label class="block text-sm font-medium mb-2">DOKTER</label>
                  <div class="relative">
                    <select
                      id="filterDoctor"
                      class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                    >
                      <option value="">Semua</option>
                      <option value="dr. Budi Sp.OT">dr. Budi Sp.OT</option>
                      <option value="drg. Andi Prasetyo, Sp.KG">
                        drg. Andi Prasetyo, Sp.KG
                      </option>
                      <option value="dr. Sarah">dr. Sarah</option>
                      <option value="dr. Sari Sp.JP">dr. Sari Sp.JP</option>
                      <option value="dr. Ahmad Sp.A">dr. Ahmad Sp.A</option>
                      <option value="dr. Rina Kusuma">dr. Rina Kusuma</option>
                      <option value="dr. Dedi Pratama">dr. Dedi Pratama</option>
                    </select>
                    <span
                      class="absolute inset-y-0 right-3 flex items-center pointer-events-none"
                    >
                      <svg
                        class="w-4 h-4 text-gray-800"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="m19 9-7 7-7-7"
                        />
                      </svg>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Area Pencarian dan Tombol -->
              <div class="flex flex-col sm:flex-row gap-3">
                <div class="flex-1">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="Ketik NRM, Nama Pasien, atau NIK"
                    class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                  />
                </div>
                <div class="flex gap-3">
                  <button
                    onclick="applyFilter()"
                    class="px-4 lg:px-6 py-2 bg-green-100 text-sm text-green-600 border border-green-300 rounded-md hover:bg-green-200 transition-colors duration-200 flex items-center gap-2 font-medium"
                  >
                    <span>Cari</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="size-4"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"
                      />
                    </svg>
                  </button>
                  <button
                    onclick="resetFilter()"
                    class="px-4 lg:px-6 py-2 bg-red-100 text-sm text-red-600 border border-red-300 rounded-md hover:bg-red-200 transition-colors duration-200 flex items-center gap-2 font-medium"
                  >
                    <span>Reset</span>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="size-4"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Div Antrian Loket -->
            <div
              class="bg-blue-light border-blue-200 p-4 lg:p-6 rounded-lg shadow-sm border flex flex-col justify-center items-center min-h-[250px]"
            >
              <!-- Info Sisa Antrian -->
              <div class="text-left mb-6">
                <p class="text-sm text-gray-600 font-medium">
                  Sisa Antrian Loket
                  <span id="currentLoketDisplay" class="font-bold text-blue-600"
                    >1</span
                  >
                  :
                  <span
                    id="remainingQueueDisplay"
                    class="font-bold text-blue-600"
                    >49</span
                  >
                </p>
              </div>

              <!-- Display Nomor Antrian -->
              <div class="text-center mb-8">
                <div
                  class="text-8xl lg:text-8xl xl:text-9xl font-bold text-blue-600 tracking-wider transition-all duration-300"
                  id="currentQueueDisplay"
                >
                  001
                </div>
              </div>

              <!-- Tombol Kontrol Antrian -->
              <div class="flex justify-center gap-3 lg:gap-4">
                <button
                  onclick="resetQueueFunction()"
                  class="w-20 h-12 lg:w-25 lg:h-15 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 flex items-center justify-center shadow-md"
                  title="Reset Antrian"
                  id="resetBtn"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"
                    />
                  </svg>
                </button>
                <button
                  onclick="repeatCallFunction()"
                  class="w-20 h-12 lg:w-25 lg:h-15 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center shadow-md"
                  title="Panggil Antrian"
                  id="soundBtn"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z"
                    />
                  </svg>
                </button>
                <button
                  onclick="callNextQueueFunction()"
                  class="w-20 h-12 lg:w-25 lg:h-15 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center justify-center shadow-md"
                  title="Antrian Selanjutnya"
                  id="nextBtn"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M3 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811V8.69ZM12.75 8.689c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061a1.125 1.125 0 0 1-1.683-.977V8.69Z"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Header Tabel -->
          <div
            class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4"
          >
            <h2 class="text-xl font-bold text-blue-600 uppercase">
              DATA PASIEN RAWAT JALAN
            </h2>
            <a
              href="../../pasien/tambah.html"
              class="py-2 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-hidden focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none"
            >
              <i class="fas fa-plus"></i>
              <span>Tambah Pasien</span>
            </a>
          </div>

          <!-- Tabel Data Pasien -->
          <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full min-w-[800px]">
                <thead class="bg-blue-50">
                  <tr
                    class="text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"
                  >
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      NO
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      AKSI
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      TANGGAL
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      NRM
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      NAMA PASIEN
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      NIK
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      J.K.
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      POLIKLINIK
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      DOKTER PJ
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      CARA BAYAR
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-start text-xs font-bold text-gray-800 uppercase"
                    >
                      TINDAK LANJUT
                    </th>
                  </tr>
                </thead>
                <tbody
                  class="bg-white divide-y divide-gray-200 text-sm text-gray-700"
                  id="patientTable"
                >
                  <!-- Data akan diisi melalui JavaScript -->
                </tbody>
              </table>
            </div>

            <!-- Paginasi -->
            <div
              class="px-4 py-3 border-t bg-gray-50 flex flex-col sm:flex-row items-center justify-between gap-4"
            >
              <p id="paginationInfo" class="text-sm text-gray-600">
                Menampilkan 1-10 dari 100 data
              </p>
              <div class="flex space-x-1">
                <button
                  class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 border rounded transition-colors"
                >
                  ‹
                </button>
                <button
                  class="px-3 py-2 text-sm bg-blue-500 text-white rounded"
                >
                  1
                </button>
                <button
                  class="px-3 py-2 text-sm text-gray-700 hover:text-gray-900 border rounded transition-colors"
                >
                  2
                </button>
                <button
                  class="px-3 py-2 text-sm text-gray-700 hover:text-gray-900 border rounded transition-colors"
                >
                  3
                </button>
                <button
                  class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700"
                >
                  ...
                </button>
                <button
                  class="px-3 py-2 text-sm text-gray-700 hover:text-gray-900 border rounded transition-colors"
                >
                  10
                </button>
                <button
                  class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 border rounded transition-colors"
                >
                  ›
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Tambah Kunjungan -->
    <div
      id="addModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white rounded-lg w-full max-w-md transform transition-all duration-300 scale-90 opacity-0"
        id="addModalContent"
      >
        <div class="bg-blue-600 text-white px-6 py-4 rounded-t-lg">
          <h3 class="text-lg font-semibold text-center uppercase">
            KUNJUNGAN RAWAT JALAN BARU
          </h3>
        </div>

        <div class="px-10 py-6">
          <form id="visitForm">
            <div class="space-y-4">
              <div>
                <h4 class="font-bold text-blue-600 mb-4 uppercase">
                  KUNJUNGAN KE-4
                </h4>
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1 uppercase"
                  >TANGGAL KUNJUNGAN</label
                >
                <input
                  type="date"
                  id="tanggalKunjungan"
                  readonly
                  class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm bg-gray-100 cursor-not-allowed transition-all"
                />
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1 uppercase"
                >
                  POLIKLINIK <span class="text-red-500">*</span>
                </label>
                <select
                  id="poliklinikSelect"
                  class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                  onchange="updateDoctorOptions()"
                >
                  <option value="">Pilih poliklinik di sini</option>
                  <option value="Poli Bedah Ortopedi">
                    Poli Bedah Ortopedi
                  </option>
                  <option value="Poli Gigi">Poli Gigi</option>
                  <option value="Poli Umum">Poli Umum</option>
                  <option value="Poli Jantung">Poli Jantung</option>
                  <option value="Poli Anak">Poli Anak</option>
                  <option value="Poli Mata">Poli Mata</option>
                  <option value="Poli THT">Poli THT</option>
                  <option value="Poli Kulit & Kelamin">
                    Poli Kulit & Kelamin
                  </option>
                  <option value="Poli Paru">Poli Paru</option>
                </select>
                <div
                  class="text-red-500 text-xs mt-1 hidden"
                  id="poliklinikError"
                >
                  Harap pilih poliklinik!
                </div>
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1 uppercase"
                >
                  DOKTER <span class="text-red-500">*</span>
                </label>
                <select
                  id="dokterSelect"
                  class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                >
                  <option value="">Pilih dokter di sini</option>
                  <option value="dr. Budi Sp.OT">dr. Budi Sp.OT</option>
                  <option value="drg. Andi Prasetyo, Sp.KG">
                    drg. Andi Prasetyo, Sp.KG
                  </option>
                  <option value="dr. Sarah">dr. Sarah</option>
                </select>
                <div class="text-red-500 text-xs mt-1 hidden" id="dokterError">
                  Harap pilih dokter!
                </div>
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1 uppercase"
                >
                  CARA BAYAR <span class="text-red-500">*</span>
                </label>
                <select
                  id="caraBayarSelect"
                  class="w-full py-3 px-4 pe-9 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white transition-all"
                >
                  <option value="">Pilih cara bayar</option>
                  <option value="BPJS">BPJS</option>
                  <option value="Umum">Umum</option>
                  <option value="Asuransi">Asuransi</option>
                </select>
                <div
                  class="text-red-500 text-xs mt-1 hidden"
                  id="caraBayarError"
                >
                  Harap pilih cara bayar!
                </div>
              </div>

              <div>
                <label
                  class="block text-sm font-medium text-gray-700 mb-1 uppercase"
                  >KETERANGAN</label
                >
                <textarea
                  placeholder="Opsional"
                  rows="3"
                  class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all resize-none"
                ></textarea>
              </div>
            </div>

            <div class="flex justify-end gap-3 mt-6">
              <button
                type="button"
                onclick="hideAddModal()"
                class="px-4 py-2 border border-gray-300 text-gray-700 text-sm rounded-lg hover:bg-gray-50 transition-colors"
              >
                Batal
              </button>
              <button
                type="button"
                onclick="saveVisit()"
                class="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors"
              >
                Simpan Kunjungan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Sukses -->
    <div
      id="successModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4"
    >
      <div
        class="bg-white rounded-lg p-8 w-full max-w-sm text-center transform transition-all duration-300 scale-95 opacity-0"
        id="successModalContent"
      >
        <div
          class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <svg
            class="w-8 h-8 text-green-500"
            fill="currentColor"
            viewBox="0 0 20 20"
          >
            <path
              fill-rule="evenodd"
              d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>

        <h3 class="text-xl font-semibold text-gray-900 mb-2">Sukses</h3>
        <p class="text-gray-600 mb-6">Berhasil menambahkan kunjungan</p>

        <div class="flex space-x-3">
          <button
            onclick="hideSuccessModal()"
            class="flex-1 px-4 py-2 border border-gray-300 text-sm text-gray-700 rounded-md hover:bg-gray-50 transition-colors"
          >
            Tutup
          </button>
          <button
            onclick="showPrintModal()"
            class="flex-1 px-4 py-2 bg-blue-600 text-sm text-white rounded-md hover:bg-blue-600 transition-colors"
          >
            Print Struk
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Print Struk -->
    <div
      id="printModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4"
      onclick="hidePrintModal()"
    >
      <div
        class="bg-white rounded-lg w-full max-w-sm transform transition-all duration-300 scale-95 opacity-0"
        id="printModalContent"
        onclick="event.stopPropagation()"
      >
        <div class="p-6">
          <div class="text-center pb-2 mb-4">
            <h3 class="text-lg font-bold text-gray-800">RSUD SLAWI</h3>
            <h4 class="text-sm font-semibold text-gray-600">
              STRUK RAWAT JALAN
            </h4>
          </div>

          <div class="space-y-2 text-sm">
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>No. Registrasi</span>
              <span>:</span>
              <span id="printRegNo">DG-20250717-01</span>
            </div>
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>Tanggal Kunjungan</span>
              <span>:</span>
              <span id="printDate">17 Juli 2025</span>
            </div>
            <div class="border-t border-dashed border-gray-300 my-4"></div>
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>NRM</span>
              <span>:</span>
              <span id="printNrm">987654</span>
            </div>
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>Nama Pasien</span>
              <span>:</span>
              <span id="printName">Nabila Banati</span>
            </div>
            <div class="border-t border-dashed border-gray-300 my-4"></div>
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>Poli Tujuan</span>
              <span>:</span>
              <span id="printPoli">-</span>
            </div>
            <div class="grid grid-cols-[2fr_auto_2fr] gap-2">
              <span>Dokter Tujuan</span>
              <span>:</span>
              <span id="printDokter">-</span>
            </div>
          </div>
          <div class="pt-2 mt-4 text-center text-xs text-gray-600">
            Harap membawa struk ini ke poli tujuan<br />
            Terima kasih atas kunjungan Anda
          </div>

          <div class="text-center mt-4 text-xs text-gray-500">
            Klik di mana saja untuk menutup
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sistem Manajemen Antrian
      class QueueSystem {
        constructor() {
          this.currentQueue =
            parseInt(localStorage.getItem("currentQueue")) || 1;
          this.totalQueue = parseInt(localStorage.getItem("totalQueue")) || 50;
          this.lokets = {
            1: {
              status: "active",
              currentNumber: this.currentQueue,
              remaining: Math.max(0, this.totalQueue - this.currentQueue),
            },
            2: { status: "active", currentNumber: 0, remaining: 0 },
            3: { status: "active", currentNumber: 0, remaining: 0 },
            4: { status: "active", currentNumber: 0, remaining: 0 },
            5: { status: "active", currentNumber: 0, remaining: 0 },
          };
          this.currentLoket = 1;
          this.isPaused = false;
          this.init();
        }

        init() {
          // Perbaikan: Pastikan updateDisplay dipanggil setelah DOM ready
          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => {
              this.updateDisplay();
              this.loadLoketData();
              this.loadVoices();
            });
          } else {
            this.updateDisplay();
            this.loadLoketData();
            this.loadVoices();
          }
        }

        loadVoices() {
          if ("speechSynthesis" in window) {
            speechSynthesis.onvoiceschanged = () => {
              this.voices = speechSynthesis.getVoices();
            };
            this.voices = speechSynthesis.getVoices();
          }
        }

        updateDisplay() {
          const currentQueueDisplay = document.getElementById(
            "currentQueueDisplay"
          );
          const currentLoketDisplay = document.getElementById(
            "currentLoketDisplay"
          );
          const remainingQueueDisplay = document.getElementById(
            "remainingQueueDisplay"
          );

          if (currentQueueDisplay)
            currentQueueDisplay.textContent = String(
              this.currentQueue
            ).padStart(3, "0");
          if (currentLoketDisplay)
            currentLoketDisplay.textContent = this.currentLoket;
          if (remainingQueueDisplay)
            remainingQueueDisplay.textContent =
              this.lokets[this.currentLoket].remaining;

          this.updateButtonStates();
        }

        updateButtonStates() {
          const resetBtn = document.getElementById("resetBtn");
          const soundBtn = document.getElementById("soundBtn");
          const nextBtn = document.getElementById("nextBtn");

          if (nextBtn) {
            if (this.lokets[this.currentLoket].remaining <= 0) {
              nextBtn.disabled = true;
              nextBtn.classList.add("opacity-50", "cursor-not-allowed");
              nextBtn.title = "Tidak ada antrian lagi";
            } else {
              nextBtn.disabled = false;
              nextBtn.classList.remove("opacity-50", "cursor-not-allowed");
              nextBtn.title = "Antrian Selanjutnya";
            }
          }

          if (soundBtn) {
            if (this.currentQueue < 1) {
              soundBtn.disabled = true;
              soundBtn.classList.add("opacity-50", "cursor-not-allowed");
              soundBtn.title = "Tidak ada antrian untuk dipanggil";
            } else {
              soundBtn.disabled = false;
              soundBtn.classList.remove("opacity-50", "cursor-not-allowed");
              soundBtn.title = "Panggil Antrian";
            }
          }
        }

        loadLoketData() {
          const savedLokets = localStorage.getItem("loketData");
          if (savedLokets) {
            try {
              this.lokets = JSON.parse(savedLokets);
            } catch (e) {
              console.error("Error parsing loket data:", e);
            }
          }
          const savedTotal = localStorage.getItem("totalQueue");
          if (savedTotal) {
            this.totalQueue = parseInt(savedTotal);
          }
        }

        saveLoketData() {
          const loketDataNew = JSON.stringify(this.lokets);
          const loketDataOld = JSON.stringify({
            loket1: this.lokets[1]?.currentNumber || 0,
            loket2: this.lokets[2]?.currentNumber || 0,
            loket3: this.lokets[3]?.currentNumber || 0,
            loket4: this.lokets[4]?.currentNumber || 0,
            loket5: this.lokets[5]?.currentNumber || 0,
          });

          localStorage.setItem("loketData", loketDataNew);
          localStorage.setItem("loketDataOld", loketDataOld);
          localStorage.setItem("currentQueue", this.currentQueue.toString());
          localStorage.setItem("currentNumber", this.currentQueue.toString());
          localStorage.setItem("totalQueue", this.totalQueue.toString());
        }

        callNextQueue() {
          if (this.isPaused) {
            alert("Antrian sedang dijeda. Aktifkan kembali untuk melanjutkan.");
            return;
          }

          if (this.currentQueue >= this.totalQueue) {
            alert("Antrian sudah mencapai batas maksimal hari ini.");
            return;
          }

          // Perbaikan: Increment queue terlebih dahulu
          this.currentQueue++;

          // Update data loket dengan perhitungan yang benar
          this.lokets[this.currentLoket].currentNumber = this.currentQueue;
          this.lokets[this.currentLoket].remaining = Math.max(
            0,
            this.totalQueue - this.currentQueue
          );

          // Update display dan simpan data
          this.updateDisplay();
          this.saveLoketData();
          this.announceQueue();
          this.broadcastUpdate();
        }

        // Fungsi untuk mengkonversi angka ke bahasa Indonesia yang natural
        numberToIndonesian(num) {
          const units = [
            "",
            "satu",
            "dua",
            "tiga",
            "empat",
            "lima",
            "enam",
            "tujuh",
            "delapan",
            "sembilan",
          ];
          const teens = [
            "sepuluh",
            "sebelas",
            "dua belas",
            "tiga belas",
            "empat belas",
            "lima belas",
            "enam belas",
            "tujuh belas",
            "delapan belas",
            "sembilan belas",
          ];
          const tens = [
            "",
            "",
            "dua puluh",
            "tiga puluh",
            "empat puluh",
            "lima puluh",
            "enam puluh",
            "tujuh puluh",
            "delapan puluh",
            "sembilan puluh",
          ];

          if (num === 0) return "nol";
          if (num < 10) return units[num];
          if (num === 10) return "sepuluh";
          if (num === 11) return "sebelas";
          if (num < 20) return teens[num - 10];
          if (num < 100) {
            const ten = Math.floor(num / 10);
            const unit = num % 10;
            return tens[ten] + (unit > 0 ? " " + units[unit] : "");
          }
          if (num < 1000) {
            const hundred = Math.floor(num / 100);
            const remainder = num % 100;
            let result = hundred === 1 ? "seratus" : units[hundred] + " ratus";
            if (remainder > 0) {
              result += " " + this.numberToIndonesian(remainder);
            }
            return result;
          }
          return String(num); // fallback untuk angka yang lebih besar
        }

        announceQueue() {
          if ("speechSynthesis" in window) {
            window.speechSynthesis.cancel();

            // Gunakan fungsi numberToIndonesian untuk pengucapan yang natural
            const queueInIndonesian = this.numberToIndonesian(
              this.currentQueue
            );
            const loketInIndonesian = this.numberToIndonesian(
              this.currentLoket
            );

            const speech = new SpeechSynthesisUtterance(
              `Nomor antrian ${queueInIndonesian}, silakan menuju loket ${loketInIndonesian}`
            );

            speech.lang = "id-ID";
            speech.rate = 0.8;
            speech.pitch = 1;
            speech.volume = 1;

            const voices = this.voices || window.speechSynthesis.getVoices();
            const indonesianVoice = voices.find(
              (voice) =>
                voice.lang.includes("id") ||
                voice.name.toLowerCase().includes("indo") ||
                voice.lang.includes("ID")
            );

            if (indonesianVoice) {
              speech.voice = indonesianVoice;
            }

            speech.onerror = function (event) {
              console.error("Speech synthesis error:", event.error);
            };

            setTimeout(() => {
              window.speechSynthesis.speak(speech);
            }, 100);
          } else {
            this.showVisualNotification();
          }
        }

        showVisualNotification() {
          const notification = document.createElement("div");
          notification.innerHTML = `
      <div class="fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300">
          🔊 Antrian ${String(this.currentQueue).padStart(3, "0")} - Loket ${
            this.currentLoket
          }
      </div>
    `;
          document.body.appendChild(notification);

          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 3000);
        }

        repeatCall() {
          if (this.currentQueue < 1) {
            alert("Belum ada antrian yang dipanggil.");
            return;
          }
          this.announceQueue();
        }

        resetQueue() {
          const confirmed = confirm(
            "Yakin ingin reset antrian? Semua data antrian akan dikembalikan ke awal."
          );
          if (!confirmed) return;

          // Perbaikan: Reset ke nilai awal yang benar
          this.currentQueue = 1;
          this.totalQueue = 50;
          this.lokets[this.currentLoket].currentNumber = this.currentQueue;
          this.lokets[this.currentLoket].remaining =
            this.totalQueue - this.currentQueue; // Perbaikan: hapus +1

          // Update display dan simpan data
          this.updateDisplay();
          this.saveLoketData();
          this.broadcastUpdate();

          alert("Antrian telah direset ke nomor 001.");
        }

        broadcastUpdate() {
          const updateData = {
            currentNumber: this.currentQueue,
            loket: this.currentLoket,
            remaining: this.lokets[this.currentLoket].remaining,
            timestamp: Date.now(),
            loketData: this.lokets,
          };

          localStorage.setItem("queueUpdate", JSON.stringify(updateData));
          localStorage.setItem("currentNumber", this.currentQueue.toString());
          localStorage.setItem("loketData", JSON.stringify(this.lokets));

          window.dispatchEvent(
            new StorageEvent("storage", {
              key: "queueUpdate",
              newValue: JSON.stringify(updateData),
            })
          );
        }
      }

      // Inisialisasi sistem antrian
      const queueSystem = new QueueSystem();

      // Data mapping dokter per poliklinik
      const doctorsByClinic = {
        "Poli Bedah Ortopedi": [
          "dr. Budi Sp.OT",
          "dr. Agus Santoso Sp.OT",
          "dr. Rina Kartika Sp.OT",
        ],
        "Poli Gigi": [
          "drg. Andi Prasetyo, Sp.KG",
          "drg. Sari Dewi",
          "drg. Ahmad Fauzi, Sp.KG",
        ],
        "Poli Umum": ["dr. Sarah", "dr. Muhammad Yusuf", "dr. Dewi Pratiwi"],
        "Poli Jantung": [
          "dr. Sari Sp.JP",
          "dr. Budi Hartono Sp.JP",
          "dr. Lisa Permata Sp.JP",
        ],
        "Poli Anak": [
          "dr. Ahmad Sp.A",
          "dr. Rina Susanti Sp.A",
          "dr. Dedi Kurniawan Sp.A",
        ],
        "Poli Mata": [
          "dr. Rina Kusuma",
          "dr. Agung Pratama Sp.M",
          "dr. Maya Sari Sp.M",
        ],
        "Poli THT": [
          "dr. Dedi Pratama",
          "dr. Siti Nurhaliza Sp.THT",
          "dr. Roni Wijaya Sp.THT",
        ],
        "Poli Kulit & Kelamin": [
          "dr. Andi Kurnia Sp.KK",
          "dr. Dewi Lestari Sp.KK",
          "dr. Budi Setiawan Sp.KK",
        ],
        "Poli Paru": [
          "dr. Ahmad Fauzi Sp.P",
          "dr. Sari Indira Sp.P",
          "dr. Roni Susanto Sp.P",
        ],
      };

      // Data contoh pasien
      const patientData = [
        {
          id: 1,
          date: "16/07/2025",
          nrm: "000001",
          name: "Muhammad Fadhlan",
          nik: "3173012300010001", // NIK dummy
          gender: "L",
          clinic: "Poli Bedah Ortopedi",
          doctor: "dr. Budi Sp.OT",
          payment: "Umum",
          action: "Pulang",
        },
        {
          id: 2,
          date: "16/07/2025",
          nrm: "000002",
          name: "Siti Nurhaliza",
          nik: "3173012300020002", // NIK dummy
          gender: "P",
          clinic: "Poli Gigi",
          doctor: "drg. Andi Prasetyo, Sp.KG",
          payment: "BPJS",
          action: "Pindah Poli",
        },
        {
          id: 3,
          date: "16/07/2025",
          nrm: "000003",
          name: "Ahmad Yusuf",
          nik: "3173012300030003", // NIK dummy
          gender: "L",
          clinic: "Poli Umum",
          doctor: "dr. Sarah",
          payment: "Umum",
          action: "Rawat Inap",
        },
        {
          id: 4,
          date: "16/07/2025",
          nrm: "000004",
          name: "Rina Sari",
          nik: "3173012300040004", // NIK dummy
          gender: "P",
          clinic: "Poli Bedah Ortopedi",
          doctor: "dr. Budi Sp.OT",
          payment: "BPJS",
          action: "Pulang",
        },
        {
          id: 5,
          date: "16/07/2025",
          nrm: "000005",
          name: "Budi Santoso",
          nik: "3173012300050005", // NIK dummy
          gender: "L",
          clinic: "Poli Gigi",
          doctor: "drg. Andi Prasetyo, Sp.KG",
          payment: "Umum",
          action: "Pulang",
        },
        {
          id: 6,
          date: "16/07/2025",
          nrm: "000006",
          name: "Dewi Lestari",
          nik: "3173012300060006", // NIK dummy
          gender: "P",
          clinic: "Poli Umum",
          doctor: "dr. Sarah",
          payment: "BPJS",
          action: "Pindah Poli",
        },
        {
          id: 7,
          date: "16/07/2025",
          nrm: "000007",
          name: "Agus Wijaya",
          nik: "3173012300070007", // NIK dummy
          gender: "L",
          clinic: "Poli Bedah Ortopedi",
          doctor: "dr. Budi Sp.OT",
          payment: "Umum",
          action: "Pulang",
        },
        {
          id: 8,
          date: "16/07/2025",
          nrm: "000008",
          name: "Maya Indira",
          nik: "3173012300080008", // NIK dummy
          gender: "P",
          clinic: "Poli Gigi",
          doctor: "drg. Andi Prasetyo, Sp.KG",
          payment: "BPJS",
          action: "Rawat Inap",
        },
        {
          id: 9,
          date: "16/07/2025",
          nrm: "000009",
          name: "Roni Susanto",
          nik: "3173012300090009", // NIK dummy
          gender: "L",
          clinic: "Poli Umum",
          doctor: "dr. Sarah",
          payment: "Umum",
          action: "Pulang",
        },
        {
          id: 10,
          date: "16/07/2025",
          nrm: "000010",
          name: "Lisa Amelia",
          nik: "3173012300100010", // NIK dummy
          gender: "P",
          clinic: "Poli Bedah Ortopedi",
          doctor: "dr. Budi Sp.OT",
          payment: "BPJS",
          action: "Pindah Poli",
        },
        {
          id: 11,
          date: "17/07/2025",
          nrm: "000011",
          name: "Andi Pratama",
          nik: "3173012300110011",
          gender: "L",
          clinic: "Poli Jantung",
          doctor: "dr. Sari Sp.JP",
          payment: "Asuransi",
          action: "Rawat Inap",
        },
        {
          id: 12,
          date: "17/07/2025",
          nrm: "000012",
          name: "Sari Indah",
          nik: "3173012300120012",
          gender: "P",
          clinic: "Poli Anak",
          doctor: "dr. Ahmad Sp.A",
          payment: "BPJS",
          action: "Pulang",
        },
        {
          id: 13,
          date: "18/07/2025",
          nrm: "000013",
          name: "Budi Setiawan",
          nik: "3173012300130013",
          gender: "L",
          clinic: "Poli Mata",
          doctor: "dr. Rina Kusuma",
          payment: "Umum",
          action: "Pindah Poli",
        },
        {
          id: 14,
          date: "18/07/2025",
          nrm: "000014",
          name: "Dewi Kartika",
          nik: "3173012300140014",
          gender: "P",
          clinic: "Poli THT",
          doctor: "dr. Dedi Pratama",
          payment: "BPJS",
          action: "Pulang",
        },
        {
          id: 15,
          date: "19/07/2025",
          nrm: "000015",
          name: "Rian Hidayat",
          nik: "3173012300150015",
          gender: "L",
          clinic: "Poli Kulit & Kelamin",
          doctor: "dr. Andi Kurnia Sp.KK",
          payment: "Asuransi",
          action: "Rawat Inap",
        },
      ];

      let currentFormData = {};
      let filteredData = [...patientData];

      // Fungsi untuk update opsi dokter berdasarkan poliklinik
      function updateDoctorOptions() {
        const poliklinikSelect = document.getElementById("poliklinikSelect");
        const dokterSelect = document.getElementById("dokterSelect");
        const selectedClinic = poliklinikSelect.value;

        // Reset dropdown dokter
        dokterSelect.innerHTML =
          '<option value="">Pilih dokter di sini</option>';

        if (selectedClinic && doctorsByClinic[selectedClinic]) {
          doctorsByClinic[selectedClinic].forEach((doctor) => {
            const option = document.createElement("option");
            option.value = doctor;
            option.textContent = doctor;
            dokterSelect.appendChild(option);
          });
        }
      }

      // Fungsi filter dengan umpan balik visual
      function applyFilter() {
        const dateFrom = document.getElementById("dateFrom").value;
        const dateTo = document.getElementById("dateTo").value;
        const payment = document.getElementById("filterPayment").value;
        const clinic = document.getElementById("filterClinic").value;
        const doctor = document.getElementById("filterDoctor").value;
        const search = document
          .getElementById("searchInput")
          .value.toLowerCase()
          .trim();

        filteredData = patientData.filter((patient) => {
          let matches = true;

          // Filter berdasarkan rentang tanggal
          if (dateFrom || dateTo) {
            // Konversi tanggal pasien dari format DD/MM/YYYY ke Date object
            const [day, month, year] = patient.date.split("/");
            const patientDate = new Date(year, month - 1, day); // month - 1 karena bulan dimulai dari 0

            if (dateFrom) {
              const fromDate = new Date(dateFrom);
              if (patientDate < fromDate) matches = false;
            }

            if (dateTo) {
              const toDate = new Date(dateTo);
              toDate.setHours(23, 59, 59, 999); // Set ke akhir hari
              if (patientDate > toDate) matches = false;
            }
          }

          // Filter berdasarkan cara bayar
          if (payment && patient.payment !== payment) matches = false;

          // Filter berdasarkan poliklinik
          if (clinic && patient.clinic !== clinic) matches = false;

          // Filter berdasarkan dokter
          if (doctor && patient.doctor !== doctor) matches = false;

          // Filter berdasarkan pencarian teks (NRM, Nama, NIK)
          if (search) {
            const searchMatch =
              patient.nrm.toLowerCase().includes(search) ||
              patient.name.toLowerCase().includes(search) ||
              patient.nik.toLowerCase().includes(search);

            if (!searchMatch) matches = false;
          }

          return matches;
        });

        populateTable();
        updateFilterResultInfo();
      }

      // Fungsi untuk menampilkan info hasil filter
      function updateFilterResultInfo() {
        const totalData = patientData.length;
        const filteredCount = filteredData.length;

        // Update informasi paginasi dengan hasil filter
        const paginationInfo = document.getElementById("paginationInfo");
        if (paginationInfo) {
          paginationInfo.textContent = `Menampilkan ${Math.min(
            1,
            filteredCount
          )}-${Math.min(10, filteredCount)} dari ${filteredCount} data`;
        }
      }

      function resetFilter() {
        document.getElementById("dateFrom").value = "2025-07-16";
        document.getElementById("dateTo").value = "2025-07-16";
        document.getElementById("filterPayment").value = "";
        document.getElementById("filterClinic").value = "";
        document.getElementById("filterDoctor").value = "";
        document.getElementById("searchInput").value = "";

        filteredData = [...patientData];
        populateTable();
        updateFilterResultInfo();
      }

      // Fungsi dropdown
      function toggleDropdown(id) {
        const dropdown = document.getElementById(`dropdown-${id}`);
        document.querySelectorAll(".dropdown-content").forEach((d) => {
          if (d.id !== `dropdown-${id}`) {
            d.classList.remove("show");
          }
        });
        dropdown.classList.toggle("show");
      }

      // Tutup dropdown saat klik di luar
      window.addEventListener("click", function (event) {
        if (!event.target.matches(".dropdown-btn")) {
          document.querySelectorAll(".dropdown-content").forEach((dropdown) => {
            dropdown.classList.remove("show");
          });
        }
      });

      // Fungsi kontrol antrian
      function callNextQueueFunction() {
        queueSystem.callNextQueue();
      }

      function repeatCallFunction() {
        queueSystem.repeatCall();
      }

      function resetQueueFunction() {
        queueSystem.resetQueue();
      }

      // Pintasan keyboard
      document.addEventListener("keydown", function (e) {
        if (e.ctrlKey && e.key === "r") {
          e.preventDefault();
          resetQueueFunction();
        } else if (
          e.code === "Space" &&
          !e.target.matches("input, textarea, select")
        ) {
          e.preventDefault();
          repeatCallFunction();
        } else if (
          e.key === "ArrowRight" &&
          !e.target.matches("input, textarea, select")
        ) {
          e.preventDefault();
          callNextQueueFunction();
        }
      });

      // Event listeners saat halaman dimuat
      document.addEventListener("DOMContentLoaded", function () {
        // Set tanggal kunjungan ke tanggal hari ini
        const today = new Date();
        const todayString = today.toISOString().split("T")[0];
        const tanggalKunjunganInput =
          document.getElementById("tanggalKunjungan");
        if (tanggalKunjunganInput) {
          tanggalKunjunganInput.value = todayString;
        }

        // Event listeners untuk filter real-time
        const filterInputs = [
          "dateFrom",
          "dateTo",
          "filterPayment",
          "filterClinic",
          "filterDoctor",
          "searchInput",
        ];
        filterInputs.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener("input", applyFilter);
            element.addEventListener("change", applyFilter);
          }
        });

        // Dukungan tombol Enter untuk pencarian
        document
          .getElementById("searchInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              applyFilter();
            }
          });

        // Animasi modal
        setupModalAnimations();

        // Inisialisasi tampilan filter
        updateFilterResultInfo();
      });
      function setupModalAnimations() {
        const modals = ["addModal", "successModal", "printModal"];
        modals.forEach((modalId) => {
          const modal = document.getElementById(modalId);
          const content = document.getElementById(modalId + "Content");

          if (modal && content) {
            modal.addEventListener("transitionend", function () {
              if (modal.classList.contains("hidden")) {
                content.classList.remove("scale-100", "opacity-100");
                content.classList.add("scale-95", "opacity-0");
              }
            });
          }
        });
      }

      // Fungsi untuk mendapatkan kelas badge aksi
      function getActionBadgeClass(action) {
        switch (action) {
          case "Pulang":
            return "bg-blue-100 text-blue-800";
          case "Pindah Poli":
            return "bg-yellow-100 text-yellow-800";
          case "Rawat Inap":
            return "bg-green-100 text-green-800";
          default:
            return "bg-gray-100 text-gray-800";
        }
      }

      // Isi tabel data
      function populateTable() {
        const tbody = document.getElementById("patientTable");
        tbody.innerHTML = "";

        filteredData.forEach((patient) => {
          const row = document.createElement("tr");
          row.className = "hover:bg-gray-50 transition-colors";

          row.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-900 text-center">${
                      patient.id
                    }</td>
                    <td class="px-4 py-3 text-sm text-center">
                        <div class="relative inline-block">
                            <button onclick="toggleDropdown(${patient.id})" 
                                    class="dropdown-btn px-3 py-2 text-blue-600 rounded text-xs hover:bg-blue-200 inline-flex items-center transition-colors cursor-pointer">
                                <svg class="w-4 h-4 text-blue-800" fill="none" viewBox="0 0 24 24">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/>
                                </svg>
                            </button>
                            <div id="dropdown-${
                              patient.id
                            }" class="dropdown-content absolute left-0 top-full mt-1 bg-white min-w-48 shadow-lg border rounded-lg z-50 hidden">
                                <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-blue-800 hover:bg-blue-100 focus:outline-hidden focus:bg-blue-100 cursor-pointer" onclick="showAddModal(${
                                  patient.id
                                })">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                                </svg>
                                    <span>Tambah Kunjungan</span>
                                    
                                </a>
                                <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-blue-800 hover:bg-blue-100 focus:outline-hidden focus:bg-blue-100 cursor-pointer" onclick="viewDetail(${
                                  patient.id
                                })">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                                  <path d="M11.625 16.5a1.875 1.875 0 1 0 0-3.75 1.875 1.875 0 0 0 0 3.75Z" />
                                  <path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6 16.5c.66 0 1.277-.19 1.797-.518l1.048 1.048a.75.75 0 0 0 1.06-1.06l-1.047-1.048A3.375 3.375 0 1 0 11.625 18Z" clip-rule="evenodd" />
                                  <path d="M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z" />
                                </svg>

                                    <span onclick="window.location.href='../../pasien/detail-pasien.html?id=' + ${patient.id}">Lihat Detail</span>
                                </a>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.date
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900 font-medium">${
                      patient.nrm
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.name
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.nik
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900 text-center">${
                      patient.gender
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.clinic
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.doctor
                    }</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${
                      patient.payment
                    }</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="inline-flex items-center gap-x-1.5 py-1.5 px-3 rounded-full text-xs font-medium ${getActionBadgeClass(
                          patient.action
                        )}">
                            ${patient.action}
                        </span>
                    </td>
                `;
          tbody.appendChild(row);
        });
      }

      populateTable();

      // Inisialisasi tampilan filter saat halaman dimuat
      updateFilterResultInfo();

      function showAddModal(patientId = null) {
        const modal = document.getElementById("addModal");
        const content = document.getElementById("addModalContent");

        // Reset form terlebih dahulu
        resetVisitForm();

        let selectedPatient = null;
        if (patientId) {
          selectedPatient = patientData.find((p) => p.id === patientId);
          if (selectedPatient) {
            console.log(
              "Menambah kunjungan untuk pasien:",
              selectedPatient.name
            );

            // Pre-fill cara bayar dari data pasien yang dipilih
            const caraBayarSelect = document.getElementById("caraBayarSelect");
            if (caraBayarSelect && selectedPatient.payment) {
              caraBayarSelect.value = selectedPatient.payment;
            }
          }
        }

        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-95", "opacity-0");
          content.classList.add("scale-100", "opacity-100");
        }, 10);

        // Simpan data pasien yang dipilih untuk digunakan di struk
        currentFormData = { patientId, selectedPatient };
      }

      function hideAddModal() {
        const modal = document.getElementById("addModal");
        const content = document.getElementById("addModalContent");

        content.classList.remove("scale-100", "opacity-100");
        content.classList.add("scale-95", "opacity-0");

        setTimeout(() => {
          modal.classList.add("hidden");
          resetVisitForm();
        }, 300);
      }

      function resetVisitForm() {
        document.getElementById("poliklinikSelect").value = "";

        // Reset dropdown dokter ke kondisi awal
        const dokterSelect = document.getElementById("dokterSelect");
        dokterSelect.innerHTML =
          '<option value="">Pilih dokter di sini</option>';

        document.getElementById("caraBayarSelect").value = "";
        document.querySelector("textarea").value = "";
        clearFormErrors();
      }

      function saveVisit() {
        const poliklinik = document.getElementById("poliklinikSelect").value;
        const dokter = document.getElementById("dokterSelect").value;
        const caraBayar = document.getElementById("caraBayarSelect").value;

        clearFormErrors();
        let hasError = false;

        if (!poliklinik) {
          showFieldError("poliklinikSelect", "poliklinikError");
          hasError = true;
        }

        if (!dokter) {
          showFieldError("dokterSelect", "dokterError");
          hasError = true;
        }

        if (!caraBayar) {
          showFieldError("caraBayarSelect", "caraBayarError");
          hasError = true;
        }

        if (hasError) return;

        currentFormData = {
          ...currentFormData,
          clinic: poliklinik,
          doctor: dokter,
          payment: caraBayar,
        };

        hideAddModal();
        showSuccessModal();
      }

      function showFieldError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);

        field.classList.add("border-red-500", "ring-red-200");
        error.classList.remove("hidden");

        field.addEventListener(
          "change",
          function () {
            clearFieldError(fieldId, errorId);
          },
          { once: true }
        );
      }

      function clearFieldError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);

        field.classList.remove("border-red-500", "ring-red-200");
        error.classList.add("hidden");
      }

      function clearFormErrors() {
        const fields = ["poliklinikSelect", "dokterSelect", "caraBayarSelect"];
        const errors = ["poliklinikError", "dokterError", "caraBayarError"];

        fields.forEach((fieldId, index) => {
          clearFieldError(fieldId, errors[index]);
        });
      }

      function showSuccessModal() {
        const modal = document.getElementById("successModal");
        const content = document.getElementById("successModalContent");

        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-95", "opacity-0");
          content.classList.add("scale-100", "opacity-100");
        }, 10);
      }

      function hideSuccessModal() {
        const modal = document.getElementById("successModal");
        const content = document.getElementById("successModalContent");

        content.classList.remove("scale-100", "opacity-100");
        content.classList.add("scale-95", "opacity-0");

        setTimeout(() => {
          modal.classList.add("hidden");
        }, 300);
      }

      function showPrintModal() {
        // Update data struk dengan data pasien yang dipilih
        const patient = currentFormData.selectedPatient;
        const today = new Date();
        const regNumber = `DG-${today.getFullYear()}${String(
          today.getMonth() + 1
        ).padStart(2, "0")}${String(today.getDate()).padStart(2, "0")}-${String(
          patient?.id || 1
        ).padStart(2, "0")}`;
        const dateString = today.toLocaleDateString("id-ID", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });

        document.getElementById("printRegNo").textContent = regNumber;
        document.getElementById("printDate").textContent = dateString;
        document.getElementById("printNrm").textContent = patient?.nrm || "-";
        document.getElementById("printName").textContent = patient?.name || "-";
        document.getElementById("printPoli").textContent =
          currentFormData.clinic || "-";
        document.getElementById("printDokter").textContent =
          currentFormData.doctor || "-";

        const modal = document.getElementById("printModal");
        const content = document.getElementById("printModalContent");

        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-95", "opacity-0");
          content.classList.add("scale-100", "opacity-100");
        }, 10);

        hideSuccessModal();
      }

      function hidePrintModal() {
        const modal = document.getElementById("printModal");
        const content = document.getElementById("printModalContent");

        content.classList.remove("scale-100", "opacity-100");
        content.classList.add("scale-95", "opacity-0");

        setTimeout(() => {
          modal.classList.add("hidden");
        }, 300);
      }

      // Fungsi untuk navigasi ke detail pasien
      function viewDetail(patientId) {
        window.location.href = `detail-pasien.html?id=${patientId}`;
      }
    </script>

    <style>
      .font-inter {
        font-family: "Inter", sans-serif;
      }
      .dropdown-content.show {
        display: block;
      }
      .dropdown-content {
        display: none;
      }
      .dropdown-btn,
      .dropdown-content a {
        cursor: pointer;
      }
    </style>
  </body>
</html>
